<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
        
          
              <link rel="shortcut icon" href="//koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/fish_opt.png">
          
        
        
          
            <link rel="icon" type="image/png" href="//koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/fish_opt.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="//koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/fish_opt.png">
          
        
    
    <!-- title -->
    <title>网站架构演进过程</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss --><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">    
      <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="https://github.com/koonchen">Projects</a></li>
         
          <li><a href="https://valeriehu1995.github.io">PigChain</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/technology/2019-04-24-java-distributed-system-chapter3/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/technology/2019-04-22-java-distributed-system-chapter1/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://chenzeping.com/technology/2019-04-23-java-distributed-system-chapter2/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://chenzeping.com/technology/2019-04-23-java-distributed-system-chapter2/&text=网站架构演进过程"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://chenzeping.com/technology/2019-04-23-java-distributed-system-chapter2/&title=网站架构演进过程"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://chenzeping.com/technology/2019-04-23-java-distributed-system-chapter2/&is_video=false&description=网站架构演进过程"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=网站架构演进过程&body=Check out this article: https://chenzeping.com/technology/2019-04-23-java-distributed-system-chapter2/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://chenzeping.com/technology/2019-04-23-java-distributed-system-chapter2/&title=网站架构演进过程"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://chenzeping.com/technology/2019-04-23-java-distributed-system-chapter2/&title=网站架构演进过程"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://chenzeping.com/technology/2019-04-23-java-distributed-system-chapter2/&title=网站架构演进过程"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://chenzeping.com/technology/2019-04-23-java-distributed-system-chapter2/&title=网站架构演进过程"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://chenzeping.com/technology/2019-04-23-java-distributed-system-chapter2/&name=网站架构演进过程&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-数据库与应用分离"><span class="toc-number">1.</span> <span class="toc-text">1.1 数据库与应用分离</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-走向集群"><span class="toc-number">2.</span> <span class="toc-text">1.2 走向集群</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-Session-Sticky"><span class="toc-number">2.1.</span> <span class="toc-text">1.2.1 Session Sticky</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2-Session-Replication"><span class="toc-number">2.2.</span> <span class="toc-text">1.2.2 Session Replication</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3-Session-数据集中存储"><span class="toc-number">2.3.</span> <span class="toc-text">1.2.3 Session 数据集中存储</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-4-Cookie-Based"><span class="toc-number">2.4.</span> <span class="toc-text">1.2.4 Cookie Based</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-读写分离"><span class="toc-number">3.</span> <span class="toc-text">1.3 读写分离</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-1-采用数据库作为读库"><span class="toc-number">3.1.</span> <span class="toc-text">1.3.1 采用数据库作为读库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-2-搜索引擎其实是一个读库"><span class="toc-number">3.2.</span> <span class="toc-text">1.3.2 搜索引擎其实是一个读库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-3-缓存"><span class="toc-number">3.3.</span> <span class="toc-text">1.3.3 缓存</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-分布式存储系统"><span class="toc-number">4.</span> <span class="toc-text">1.4 分布式存储系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-读写分离后数据库拆分"><span class="toc-number">5.</span> <span class="toc-text">1.5 读写分离后数据库拆分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-1-垂直拆分"><span class="toc-number">5.1.</span> <span class="toc-text">1.5.1 垂直拆分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-2-水平拆分"><span class="toc-number">5.2.</span> <span class="toc-text">1.5.2 水平拆分</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6-数据库问题外的挑战"><span class="toc-number">6.</span> <span class="toc-text">1.6 数据库问题外的挑战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-1-拆分应用"><span class="toc-number">6.1.</span> <span class="toc-text">1.6.1 拆分应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-2-走向服务化"><span class="toc-number">6.2.</span> <span class="toc-text">1.6.2 走向服务化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-7-消息中间件"><span class="toc-number">7.</span> <span class="toc-text">1.7 消息中间件</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        网站架构演进过程
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">空城</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2019-04-22T16:00:00.000Z" itemprop="datePublished">2019-04-23</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/technology/">technology</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/分布式/">分布式</a>, <a class="tag-link" href="/tags/大型网站系统与-Java-中间件开发实践/">大型网站系统与 Java 中间件开发实践</a>
    </div>


    </div>
  </header>
  <!-- 
 -->
  <div class="content" itemprop="articleBody">
    <p><strong>中间件系统也是在大型网站的架构变化中出现并发展的</strong>。</p>
<p>访问量大的网站不一定是大型网站，<strong>大型网站</strong>应该有大量的数据，或者说是海量的数据，<strong>访问量和数据量缺一不可</strong>。</p>
<h2 id="1-1-数据库与应用分离"><a href="#1-1-数据库与应用分离" class="headerlink" title="1.1 数据库与应用分离"></a>1.1 数据库与应用分离</h2><p>我们关注的重点是随着<strong>数据量</strong>、<strong>访问量</strong>，网站也将因此产生结构上的变化，而不关注具体的业务功能点。</p>
<p>随着数据访问量不断增大，服务器的负载持续升高，此时我们可以通过将数据库和应用从一台机器分到两台机器上来进行优化，即<strong>数据库与应用分离</strong>。</p>
<p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/20190427222026.png" alt></p>
<h2 id="1-2-走向集群"><a href="#1-2-走向集群" class="headerlink" title="1.2 走向集群"></a>1.2 走向集群</h2><p>在增加一台服务器以后，<strong>可以通过 DNS 解决，也可以通过在服务器集群前增加负载均衡设备来解决</strong>。同时我们还需要处理 Session 问题。</p>
<p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/20190427224601.png" alt></p>
<p>这是加入负载均衡器以后的样子：</p>
<p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/20190427224807.png" alt></p>
<h3 id="1-2-1-Session-Sticky"><a href="#1-2-1-Session-Sticky" class="headerlink" title="1.2.1 Session Sticky"></a>1.2.1 Session Sticky</h3><p>对于 Session 问题，我们有多种解决方式。<strong>Web 服务器有多台以后，如果保证同一个会话的请求都在同一个 Web 服务器上处理，那么对于这个会话而言，它还是单机</strong>。</p>
<p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/20190427225014.png" alt></p>
<p>我们只需要在「负载均衡器」上动手脚，就可以办到。但是有许多问题：</p>
<ul>
<li>如果一台 Web 服务器宕机，那么这台机器上的数据就会丢失；</li>
<li>会话标识是应用层的信息，「负载均衡器」要将「一个会话」的请求都保存在一个 Web 服务器上，就需要进行应用层的解析，这个开销比第4层的交换要大；</li>
<li>负载均衡器变为一个有状态的节点，要将会话保存到具体的 Web 服务器的映射，和无状态的节点相比，消耗内存更大，容灾更麻烦。</li>
</ul>
<h3 id="1-2-2-Session-Replication"><a href="#1-2-2-Session-Replication" class="headerlink" title="1.2.2 Session Replication"></a>1.2.2 Session Replication</h3><p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/20190502175612.png" alt></p>
<p><strong>现在，不再要求负载均衡器来保证同一个会话的多次请求必须到同一个 Web 服务器上</strong>，而我们的 Web 服务器之间增加了会话的同步，通过同步就保证了不同 Web 服务器之间的 Session 数据一致。它的问题：</p>
<ul>
<li>同步 Session 数据造成了网络带宽的开销，<strong>只要 Session 数据有变化，就需要将数据同步到所有的机器上</strong>，机器数越多，同步带来的网络带宽开销就越大；</li>
<li>每台 Web 服务器都要保存所有的 Session 数据，如果整个集群的 Session 数据很多的话，<strong>每台机器用于保存 Session 数据的内容占用会很严重</strong>。</li>
</ul>
<blockquote>
<p>如果只有几台机器，这个方案是可行的。</p>
</blockquote>
<h3 id="1-2-3-Session-数据集中存储"><a href="#1-2-3-Session-数据集中存储" class="headerlink" title="1.2.3 Session 数据集中存储"></a>1.2.3 Session 数据集中存储</h3><p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/20190502180715.png" alt></p>
<p>我们把 Session 数据集中存储起来，然后不同 Web 服务器从同样的地方来获取 Session ，<strong>会话请求经过负载均衡器后，不会固定在同样的 Web 服务器上，且 Web 服务器上不再需要 Session 数据复制了</strong>，它的问题：</p>
<ul>
<li>读写 Session 引入了网络操作，这相对于本机的数据读取来说，问题在于存在时延和不稳定性，不过通信都发生在内网中，问题不是很大；</li>
<li>如果集中存储 Session 的机器或者集群出现问题，会影响我们的应用。</li>
</ul>
<h3 id="1-2-4-Cookie-Based"><a href="#1-2-4-Cookie-Based" class="headerlink" title="1.2.4 Cookie Based"></a>1.2.4 Cookie Based</h3><p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/20190502181811.png" alt></p>
<p>所谓「Cookie Based」对于同一个会话的不同请求也是不限制具体处理机器的，<strong>它通过 Cookie 来传递 Session 数据</strong>。它的问题：</p>
<ul>
<li>Cookie 是有长度限制的，这也限制了 Session 数据的长度；</li>
<li>安全性，Session 数据本来是服务端的，这个方案可以对 Session 数据进行加密，但是从物理上禁止接触才是安全的；</li>
<li>带宽消耗，我们需要传输的内容增加了；</li>
<li>性能影响，每次 HTTP 请求和响应都带有 Session 数据，Web 服务器在同样的处理下，响应的结果输出越少，支持的并发请求就会越多。</li>
</ul>
<blockquote>
<p>具体情况具体分析，没有绝对的好与不好。</p>
</blockquote>
<h2 id="1-3-读写分离"><a href="#1-3-读写分离" class="headerlink" title="1.3 读写分离"></a>1.3 读写分离</h2><h3 id="1-3-1-采用数据库作为读库"><a href="#1-3-1-采用数据库作为读库" class="headerlink" title="1.3.1 采用数据库作为读库"></a>1.3.1 采用数据库作为读库</h3><p>随着业务的发展，我们的数据量和访问量都在提升，对于大型网站来说，<strong>不少业务都是读多写少的</strong>，这个状况也会直接反应到数据库上，那么对于这样的情况，我们可以考虑使用<strong>读写分离</strong>的方式。</p>
<p>我们给系统加上一个读库：</p>
<p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/20190502185114.png" alt></p>
<p>这个架构有两个问题：</p>
<ul>
<li>数据复制问题；</li>
<li>应用对于数据源的选择问题。</li>
</ul>
<p>数据复制延迟带来的就是短期的数据不一致，比如 MySQL 支持 Master + Slave 的结构，提供了数据复制的机制，在 MySQL 5.5 之前的版本支持的都是异步的数据分支，会有延迟，并且是完全镜像方式的复制，保证了备库和主库的数据一致性，<strong>而在 MySQL 5.5 中加入了 semi-sync 办同步的支持</strong>，它比异步复制要好。主库写入 binlog 之后，会强制此时立即将数据同步到从库，从库将日志写入本地的 relay log 之后，会返回一个 ack 到主库，主库接到至少一个从库的 ack 才认为这条 binlog 写成功。<strong>所谓半同步，是说从库将数据拉到 relay log 就算同步成功了</strong>。</p>
<p>写操作走主库，读走从库，<strong>而事务中的读走主库</strong>，所以，不同业务下的选择是有差异的。</p>
<h3 id="1-3-2-搜索引擎其实是一个读库"><a href="#1-3-2-搜索引擎其实是一个读库" class="headerlink" title="1.3.2 搜索引擎其实是一个读库"></a>1.3.2 搜索引擎其实是一个读库</h3><p>在搜索的时候，我们可以想到使用数据库的 like 功能，这种实现的代价很大，我们还可以使用<strong>搜索引擎的倒排表方式</strong>，它大大提升了检索速度，如何对记录进行排序是很重要的。</p>
<p>搜索引擎的功能，首先就是需要根据被搜索的数据来构建索引。随着被搜索的数据的变化，索引也要变化，什么样的数据走搜索，什么样的数据走数据库，其实<strong>构建搜索的过程就是一个数据复制的过程</strong>。</p>
<p>加入搜索引擎以后系统的结构：</p>
<p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/20190502192538.png" alt></p>
<p>可以看到集群 Search Cluster 的使用方式和读库的使用是一样的，只是「构建索引的过程」基本都是我们自己来实现的，我们从两个维度对搜索系统构建索引的方式进行划分：</p>
<ul>
<li>全量/增量划分；</li>
<li>实时/非实时划分。</li>
</ul>
<p>全量用于第一次建立索引，而增量用于在全量基础上持续更新索引；实时体现在索引更新的时间上，非实时主要考虑对数据源头的保护。</p>
<h3 id="1-3-3-缓存"><a href="#1-3-3-缓存" class="headerlink" title="1.3.3 缓存"></a>1.3.3 缓存</h3><p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/20190502194611.png" alt></p>
<p>大体上我们将缓存分为：</p>
<ul>
<li>数据缓存：一般在缓存中的数据是 key-value 这样的键值对，而在其中我们放的是<strong>热数据</strong>；</li>
<li>页面缓存：一般「数据缓存」用来加快请求时的数据读取，但最终我们返回给用户的还是页面，有些动态生成的页面或者一部分特别热，我们可以对这些内容进行缓存。<ul>
<li>以前的方式是使用 Apache 的 ESI 模块，但是这个过程需要对响应结果进行分析，对于不存在内容，会通过 Web 服务器去渲染，再放入缓存中，返回给浏览器；</li>
<li>改进后，可以使用比如 JBoss 的 ESI 功能，它在 Web 浏览器中完成渲染和缓存相关的功能，这样更高效，但是没有前一种分工明确。</li>
</ul>
</li>
</ul>
<h2 id="1-4-分布式存储系统"><a href="#1-4-分布式存储系统" class="headerlink" title="1.4 分布式存储系统"></a>1.4 分布式存储系统</h2><p>前面，我们把目光集中在数据库，没有错误，因为数据库就是我们性能上遇到的一重大山，<strong>但是很多场景下，数据库并不是很合适</strong>，也就是分布式存储系统。</p>
<p>分布式存储系统提供一个高容量、高并发、数据冗余容灾的支持，具体有三个常见类：</p>
<ul>
<li>通过分布式文件系统解决小文件和大文件的存储问题；</li>
<li>通过分布式 Key-Value 系统提供高性能的半结构化支持；</li>
<li>通过分布式数据库提供一个支持大数据、高并发的数据库系统。</li>
</ul>
<p>现在我们的系统大概长这样：</p>
<p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/20190502195810.png" alt></p>
<h2 id="1-5-读写分离后数据库拆分"><a href="#1-5-读写分离后数据库拆分" class="headerlink" title="1.5 读写分离后数据库拆分"></a>1.5 读写分离后数据库拆分</h2><p>随着业务的增加，我们的主库也会遇到瓶颈，现在我们有数据库垂直和水平拆分两种选择。</p>
<h3 id="1-5-1-垂直拆分"><a href="#1-5-1-垂直拆分" class="headerlink" title="1.5.1 垂直拆分"></a>1.5.1 垂直拆分</h3><p><strong>换句话说，比如可以把不同业务数据拆分到不同的数据库中，当然，拆法不唯一</strong>。</p>
<p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/20190502200143.png" alt></p>
<p>这样做的影响是，我们多了很多数据源是肯定的，每个数据库连接池的隔离，还有<strong>跨业务事务处理</strong>，两种主流处理方式：</p>
<ul>
<li>分布式事务；</li>
<li>去掉事务或者不去追求强事务支持。</li>
</ul>
<blockquote>
<p>垂直拆分解决业务数据都放到一个数据库中的压力问题。</p>
</blockquote>
<h3 id="1-5-2-水平拆分"><a href="#1-5-2-水平拆分" class="headerlink" title="1.5.2 水平拆分"></a>1.5.2 水平拆分</h3><p><strong>水平拆分就是把一个表的数据拆到两个数据库中</strong>，这是因为数据量或者更新量太大。</p>
<p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/20190502200908.png" alt></p>
<p>之后要解决这些问题：</p>
<ul>
<li>数据库的路由，现在有两个库了，数据库操作应该了解操作的数据在哪儿。</li>
<li>主键处理，原来依赖单个数据库的一些机制需要变化，原来使用的自增字段，现在不能用自增来保证主键不重复了。</li>
<li>一些操作需要同时两个表，比如分页操作等。</li>
</ul>
<blockquote>
<p>好处在于一旦完成，我们可以很好应对写入增长的情况。</p>
</blockquote>
<h2 id="1-6-数据库问题外的挑战"><a href="#1-6-数据库问题外的挑战" class="headerlink" title="1.6 数据库问题外的挑战"></a>1.6 数据库问题外的挑战</h2><h3 id="1-6-1-拆分应用"><a href="#1-6-1-拆分应用" class="headerlink" title="1.6.1 拆分应用"></a>1.6.1 拆分应用</h3><p>前面我们都在解决数据层面的问题，现在我们要考虑的<strong>是不让应用持续变大</strong>，需要将应用拆分，从一个应用编程两个或者多个应用。</p>
<p>一个简单的方式是根据应用特性把应用拆分，这样可以把一个大应用变小。并且这些业务应用之间不存在直接调用，它们都依赖底层的数据库、缓存、文件系统、搜索等。</p>
<p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/20190502201556.png" alt></p>
<h3 id="1-6-2-走向服务化"><a href="#1-6-2-走向服务化" class="headerlink" title="1.6.2 走向服务化"></a>1.6.2 走向服务化</h3><p>这是一个服务化系统结构的简图：</p>
<p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/20190502201706.png" alt></p>
<p>顶层 Web 系统，中间服务中心，底层数据库。</p>
<p>各个服务中心可能不在一个机器上，当然其他 Web 系统或者数据库可能也不在一个机器上，所以主要通过远程调用的形式交互，连接数据库的事情交给了数据库，更好控制系统本身的发展。</p>
<h2 id="1-7-消息中间件"><a href="#1-7-消息中间件" class="headerlink" title="1.7 消息中间件"></a>1.7 消息中间件</h2><p>Message-oriented middleware MOM 消息中间件，<strong>它是在分布式系统中完成消息的发送和接收的基础软件</strong>。</p>
<p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/20190502202115.png" alt></p>
<p>它最大的两个好处：异步、解耦。应用 A 和应用 B 都和消息中间件打交道，而这两个应用并不会直接联系。</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="https://github.com/koonchen">Projects</a></li>
         
          <li><a href="https://valeriehu1995.github.io">PigChain</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-数据库与应用分离"><span class="toc-number">1.</span> <span class="toc-text">1.1 数据库与应用分离</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-走向集群"><span class="toc-number">2.</span> <span class="toc-text">1.2 走向集群</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-Session-Sticky"><span class="toc-number">2.1.</span> <span class="toc-text">1.2.1 Session Sticky</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2-Session-Replication"><span class="toc-number">2.2.</span> <span class="toc-text">1.2.2 Session Replication</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3-Session-数据集中存储"><span class="toc-number">2.3.</span> <span class="toc-text">1.2.3 Session 数据集中存储</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-4-Cookie-Based"><span class="toc-number">2.4.</span> <span class="toc-text">1.2.4 Cookie Based</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-读写分离"><span class="toc-number">3.</span> <span class="toc-text">1.3 读写分离</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-1-采用数据库作为读库"><span class="toc-number">3.1.</span> <span class="toc-text">1.3.1 采用数据库作为读库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-2-搜索引擎其实是一个读库"><span class="toc-number">3.2.</span> <span class="toc-text">1.3.2 搜索引擎其实是一个读库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-3-缓存"><span class="toc-number">3.3.</span> <span class="toc-text">1.3.3 缓存</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-分布式存储系统"><span class="toc-number">4.</span> <span class="toc-text">1.4 分布式存储系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-读写分离后数据库拆分"><span class="toc-number">5.</span> <span class="toc-text">1.5 读写分离后数据库拆分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-1-垂直拆分"><span class="toc-number">5.1.</span> <span class="toc-text">1.5.1 垂直拆分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-2-水平拆分"><span class="toc-number">5.2.</span> <span class="toc-text">1.5.2 水平拆分</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6-数据库问题外的挑战"><span class="toc-number">6.</span> <span class="toc-text">1.6 数据库问题外的挑战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-1-拆分应用"><span class="toc-number">6.1.</span> <span class="toc-text">1.6.1 拆分应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-2-走向服务化"><span class="toc-number">6.2.</span> <span class="toc-text">1.6.2 走向服务化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-7-消息中间件"><span class="toc-number">7.</span> <span class="toc-text">1.7 消息中间件</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://chenzeping.com/technology/2019-04-23-java-distributed-system-chapter2/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://chenzeping.com/technology/2019-04-23-java-distributed-system-chapter2/&text=网站架构演进过程"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://chenzeping.com/technology/2019-04-23-java-distributed-system-chapter2/&title=网站架构演进过程"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://chenzeping.com/technology/2019-04-23-java-distributed-system-chapter2/&is_video=false&description=网站架构演进过程"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=网站架构演进过程&body=Check out this article: https://chenzeping.com/technology/2019-04-23-java-distributed-system-chapter2/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://chenzeping.com/technology/2019-04-23-java-distributed-system-chapter2/&title=网站架构演进过程"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://chenzeping.com/technology/2019-04-23-java-distributed-system-chapter2/&title=网站架构演进过程"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://chenzeping.com/technology/2019-04-23-java-distributed-system-chapter2/&title=网站架构演进过程"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://chenzeping.com/technology/2019-04-23-java-distributed-system-chapter2/&title=网站架构演进过程"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://chenzeping.com/technology/2019-04-23-java-distributed-system-chapter2/&name=网站架构演进过程&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2022 Koon Chen
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="https://github.com/koonchen">Projects</a></li>
         
          <li><a href="https://valeriehu1995.github.io">PigChain</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<!-- <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"> -->
<link rel="stylesheet" href="//cdn.staticfile.org/font-awesome/5.2.0/css/all.min.css">
<!-- <link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css"> -->
<link rel="stylesheet" href="//cdn.staticfile.org/justifiedGallery/3.6.5/css/justifiedGallery.min.css">

    <!-- jquery -->
<!-- <script src="/lib/jquery/jquery.min.js"></script> -->
<script src="//cdn.staticfile.org/jquery/3.3.1/jquery.min.js"></script>
<!-- <script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script> -->
<script src="//cdn.staticfile.org/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-109260587-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdn.bootcss.com/mathjax/2.7.6/MathJax.js?config=TeX-MML-AM_CHTML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>
