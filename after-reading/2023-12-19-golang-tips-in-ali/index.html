<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
        
          
              <link rel="shortcut icon" href="//koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/fish_opt.png">
          
        
        
          
            <link rel="icon" type="image/png" href="//koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/fish_opt.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="//koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/fish_opt.png">
          
        
    
    <!-- title -->
    <title>golang tips in ali</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss --><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">    
      <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="https://github.com/koonchen">Projects</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/after-reading/2023-12-18-calculated-advertising/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://chenzeping.com/after-reading/2023-12-19-golang-tips-in-ali/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://chenzeping.com/after-reading/2023-12-19-golang-tips-in-ali/&text=golang tips in ali"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://chenzeping.com/after-reading/2023-12-19-golang-tips-in-ali/&title=golang tips in ali"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://chenzeping.com/after-reading/2023-12-19-golang-tips-in-ali/&is_video=false&description=golang tips in ali"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=golang tips in ali&body=Check out this article: https://chenzeping.com/after-reading/2023-12-19-golang-tips-in-ali/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://chenzeping.com/after-reading/2023-12-19-golang-tips-in-ali/&title=golang tips in ali"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://chenzeping.com/after-reading/2023-12-19-golang-tips-in-ali/&title=golang tips in ali"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://chenzeping.com/after-reading/2023-12-19-golang-tips-in-ali/&title=golang tips in ali"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://chenzeping.com/after-reading/2023-12-19-golang-tips-in-ali/&title=golang tips in ali"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://chenzeping.com/after-reading/2023-12-19-golang-tips-in-ali/&name=golang tips in ali&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#高频技艺"><span class="toc-number">1.</span> <span class="toc-text">高频技艺</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#函数集合"><span class="toc-number">1.1.</span> <span class="toc-text">函数集合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Context-教学"><span class="toc-number">1.2.</span> <span class="toc-text">Context 教学</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#普通异常处理"><span class="toc-number">1.3.</span> <span class="toc-text">普通异常处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义业务异常"><span class="toc-number">1.4.</span> <span class="toc-text">自定义业务异常</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Panic-处理"><span class="toc-number">1.5.</span> <span class="toc-text">Panic 处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sync-atomic-共享变量"><span class="toc-number">1.6.</span> <span class="toc-text">sync.atomic 共享变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sync-Mutex-上锁"><span class="toc-number">1.7.</span> <span class="toc-text">sync.Mutex 上锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sync-Cond-消费者范式"><span class="toc-number">1.8.</span> <span class="toc-text">sync.Cond 消费者范式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#json-结构定义"><span class="toc-number">1.9.</span> <span class="toc-text">json 结构定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#项目生成类图"><span class="toc-number">1.10.</span> <span class="toc-text">项目生成类图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#标准目录"><span class="toc-number">1.11.</span> <span class="toc-text">标准目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#性能优化"><span class="toc-number">1.12.</span> <span class="toc-text">性能优化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#最佳实践"><span class="toc-number">2.</span> <span class="toc-text">最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#好的开始是成功的一半"><span class="toc-number">2.1.</span> <span class="toc-text">好的开始是成功的一半</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基本规范"><span class="toc-number">2.2.</span> <span class="toc-text">基本规范</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#错误处理"><span class="toc-number">2.3.</span> <span class="toc-text">错误处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#让别人参与进来"><span class="toc-number">2.4.</span> <span class="toc-text">让别人参与进来</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#养好服务"><span class="toc-number">2.5.</span> <span class="toc-text">养好服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注意事项"><span class="toc-number">2.6.</span> <span class="toc-text">注意事项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#核心类型"><span class="toc-number">2.7.</span> <span class="toc-text">核心类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#八股文"><span class="toc-number">2.8.</span> <span class="toc-text">八股文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#书籍推荐"><span class="toc-number">2.9.</span> <span class="toc-text">书籍推荐</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">2.10.</span> <span class="toc-text">总结</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        golang tips in ali
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">空城</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-12-18T16:00:00.000Z" itemprop="datePublished">2023-12-19</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/reading/">reading</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/golang/">golang</a>
    </div>


    </div>
  </header>
  <!-- 
 -->
  <div class="content" itemprop="articleBody">
    <h1 id="高频技艺"><a href="#高频技艺" class="headerlink" title="高频技艺"></a>高频技艺</h1><h2 id="函数集合"><a href="#函数集合" class="headerlink" title="函数集合"></a>函数集合</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Op 保存对 msg 处理的函数集合</span></span><br><span class="line"><span class="keyword">type</span> Op <span class="function"><span class="keyword">func</span><span class="params">(msg any)</span> <span class="params">(any, error)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 解码远程消息</span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">decode</span><span class="params">(msg any)</span> <span class="title">Op</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(any)</span> <span class="params">(any, error)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"decoding ..."</span>, msg)</span><br><span class="line">		decodedRes := fmt.Sprintf(<span class="string">"decoded_%v"</span>, msg)</span><br><span class="line">		fmt.Println(<span class="string">"decoded to parameter-&gt;"</span>, decodedRes)</span><br><span class="line">		<span class="keyword">return</span> decodedRes, <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模拟业务处理</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">opAction</span><span class="params">(parameter any)</span> <span class="title">Op</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(any)</span> <span class="params">(any, error)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"do opAction ..."</span>, parameter)</span><br><span class="line">		opRes := fmt.Sprintf(<span class="string">"opAction_%v"</span>, parameter)</span><br><span class="line">		fmt.Println(<span class="string">"after opAction result-&gt;"</span>, opRes)</span><br><span class="line">		<span class="keyword">return</span> opRes, <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模拟结果处理</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">encode</span><span class="params">(result any)</span> <span class="title">Op</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(any)</span> <span class="params">(any, error)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"encoding ..."</span>, result)</span><br><span class="line">		encodeRes := fmt.Sprintf(<span class="string">"encoded_%v"</span>, result)</span><br><span class="line">		fmt.Println(<span class="string">"after encoded result-&gt;"</span>, encodeRes)</span><br><span class="line">		<span class="keyword">return</span> encodeRes, <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里的 <code>Op</code> 定义了对 <code>msg</code> 处理的『函数集合』，function 在 Golang 当中是一等公民，类 Java Lambda 表达式，使用 Golang Function 可以方便定义函数算子，真正实现函数式编程。</p>
<p>实际使用中，可以定义多种 <code>Op</code>，放到 <code>map</code> 中去，可以根据一些信息比如 message tag 做一些路由处理</p>
<h2 id="Context-教学"><a href="#Context-教学" class="headerlink" title="Context 教学"></a>Context 教学</h2><p>go 中 context 是用来管理程序中跨越多个 goroutine 的数据、取消信号、截止时间等的标准方法。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCtx</span><span class="params">()</span></span> &#123;</span><br><span class="line">	bg := context.Background() <span class="comment">// 顶层 ctx</span></span><br><span class="line">	fmt.Println(bg)</span><br><span class="line">	todo := context.TODO() <span class="comment">// 不清楚使用哪种 ctx 或者当前函数之后会更新 ctx</span></span><br><span class="line">	fmt.Println(todo)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.ctx 不可变</span></span><br><span class="line"><span class="comment">// 2.withValue 会基于 pCtx 生成 cCtx</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CtxWithValue</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ctxA := context.Background()</span><br><span class="line">	ctxB := context.WithValue(ctxA, <span class="string">"b"</span>, <span class="string">"B"</span>)</span><br><span class="line">	ctxC := context.WithValue(ctxA, <span class="string">"c"</span>, <span class="string">"C"</span>)</span><br><span class="line">	ctxD := context.WithValue(ctxB, <span class="string">"d"</span>, <span class="string">"D"</span>)</span><br><span class="line">	ctxE := context.WithValue(ctxB, <span class="string">"e"</span>, <span class="string">"E"</span>)</span><br><span class="line">	ctxF := context.WithValue(ctxC, <span class="string">"f"</span>, <span class="string">"F"</span>)</span><br><span class="line">	fmt.Println(ctxA) <span class="comment">// a</span></span><br><span class="line">	fmt.Println(ctxB) <span class="comment">// a-&gt;b</span></span><br><span class="line">	fmt.Println(ctxC) <span class="comment">// a-&gt;c</span></span><br><span class="line">	fmt.Println(ctxD) <span class="comment">// a-&gt;b-&gt;d</span></span><br><span class="line">	fmt.Println(ctxE) <span class="comment">// a-&gt;b-&gt;e</span></span><br><span class="line">	fmt.Println(ctxF) <span class="comment">// a-&gt;c-&gt;f</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. cCtx 可以访问 pCtx</span></span><br><span class="line"><span class="comment">// 2. 分支路径上的 ctx 之间不能互相访问</span></span><br><span class="line"><span class="comment">// 3. pCtx 不能访问 cCtx 中的值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AccessParentContextValue</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ctxA := context.Background()</span><br><span class="line">	ctxB := context.WithValue(ctxA, <span class="string">"b"</span>, <span class="string">"B"</span>)</span><br><span class="line">	ctxC := context.WithValue(ctxA, <span class="string">"c"</span>, <span class="string">"C"</span>)</span><br><span class="line">	ctxF := context.WithValue(ctxC, <span class="string">"f"</span>, <span class="string">"F"</span>)</span><br><span class="line">	fmt.Println(ctxF.Value(<span class="string">"f"</span>)) <span class="comment">// 访问 self</span></span><br><span class="line">	fmt.Println(ctxF.Value(<span class="string">"c"</span>)) <span class="comment">// 访问 pCtx</span></span><br><span class="line">	fmt.Println(ctxF.Value(<span class="string">"b"</span>)) <span class="comment">// 分支路径上的 ctx 不能访问</span></span><br><span class="line">	fmt.Println(ctxB.Value(<span class="string">"f"</span>)) <span class="comment">// pCtx 不能访问 cCtx</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="普通异常处理"><a href="#普通异常处理" class="headerlink" title="普通异常处理"></a>普通异常处理</h2><p>使用原生 error package + 直接比较。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	errorNotFound     = errors.New(<span class="string">"item not found"</span>)</span><br><span class="line">	errorMissingParam = errors.New(<span class="string">"missing param"</span>)</span><br><span class="line">	errorUnknown      = <span class="string">"unKnownErr"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">HandlingErrorInSimpleCase</span><span class="params">(key <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	val, err := getItem(key)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		switchErrByComparison(err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(val)</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getItem</span><span class="params">(key <span class="keyword">string</span>)</span> <span class="params">(any, error)</span></span> &#123;</span><br><span class="line">	cn := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line">	val, ok := cn[key]</span><br><span class="line">	<span class="keyword">if</span> !ok &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errorNotFound</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> val, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">switchErrByComparison</span><span class="params">(err error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">switch</span> err &#123;</span><br><span class="line">	<span class="keyword">case</span> errorNotFound:</span><br><span class="line">		fmt.Println(errorNotFound.Error())</span><br><span class="line">	<span class="keyword">case</span> errorMissingParam:</span><br><span class="line">		fmt.Println(errorMissingParam.Error())</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		fmt.Println(errorUnknown)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果有根据 errType 分组的需求应该如何实现呢？</p>
<h2 id="自定义业务异常"><a href="#自定义业务异常" class="headerlink" title="自定义业务异常"></a>自定义业务异常</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> errorType <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	errorNotFound     errorType = <span class="string">"item not found"</span></span><br><span class="line">	errorMissingParam errorType = <span class="string">"missing param"</span></span><br><span class="line">	errorUnknown      errorType = <span class="string">"unKnownErr"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> BusinessError <span class="keyword">struct</span> &#123;</span><br><span class="line">	errorType errorType</span><br><span class="line">	msg       <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewBusinessError</span><span class="params">(errorType errorType, msg <span class="keyword">string</span>)</span> *<span class="title">BusinessError</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;BusinessError&#123;errorType, msg&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *BusinessError)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">"%v_%v"</span>, e.errorType, e.msg)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">switchErrByType</span><span class="params">(err error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">switch</span> err.(<span class="keyword">type</span>) &#123;</span><br><span class="line">		<span class="keyword">case</span> *BusinessError:</span><br><span class="line">			fmt.Println(err.Error())</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			fmt.Println(errorUnknown)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Panic-处理"><a href="#Panic-处理" class="headerlink" title="Panic 处理"></a>Panic 处理</h2><p>panic 主要处理程序出现的异常，而非业务异常：</p>
<ol>
<li><code>panic(errMsg)</code> 显式抛出异常</li>
<li><p>recover 可以捕捉 panic，但是只能在 defer 中使用，可以将异常 goroutine 从 panic 中恢复</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> err := <span class="built_in">recover</span>(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>
</li>
<li><p>recover 只在当前 goroutine 有效，不能跨 goroutine 捕捉异常</p>
</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">PanicSimulate</span><span class="params">(key <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="comment">// 只对当前 goroutine 有效</span></span><br><span class="line">		<span class="keyword">if</span> err := <span class="built_in">recover</span>(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> key == <span class="number">2</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(fmt.Sprintf(<span class="string">"key == 2"</span>))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"run ok"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runRoutines</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">go</span> PanicSimulate(i)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 保持 goroutines 运行</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="sync-atomic-共享变量"><a href="#sync-atomic-共享变量" class="headerlink" title="sync.atomic 共享变量"></a>sync.atomic 共享变量</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UnSafeAdd</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> n <span class="keyword">int</span> = <span class="number">0</span></span><br><span class="line">	<span class="keyword">var</span> wg *sync.WaitGroup = <span class="built_in">new</span>(sync.WaitGroup)</span><br><span class="line">	wg.Add(<span class="number">1000</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(w *sync.WaitGroup, num *<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">			<span class="keyword">defer</span> w.Done()</span><br><span class="line">			*num = *num + <span class="number">1</span> <span class="comment">// 这个操作不是原子的</span></span><br><span class="line">		&#125;(wg, &amp;n) <span class="comment">// 最终结果 n 不等于 1000</span></span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SafeAdd</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> n <span class="keyword">int32</span> = <span class="number">0</span></span><br><span class="line">	<span class="keyword">var</span> wg *sync.WaitGroup = <span class="built_in">new</span>(sync.WaitGroup)</span><br><span class="line">	wg.Add(<span class="number">1000</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(w *sync.WaitGroup, num *<span class="keyword">int32</span>)</span></span> &#123;</span><br><span class="line">			<span class="keyword">defer</span> w.Done()</span><br><span class="line">			atomic.AddInt32(num, <span class="number">1</span>) <span class="comment">// 操作是原子的</span></span><br><span class="line">		&#125;(wg, &amp;n) <span class="comment">// 最终 n 等于 1000</span></span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="sync-Mutex-上锁"><a href="#sync-Mutex-上锁" class="headerlink" title="sync.Mutex 上锁"></a>sync.Mutex 上锁</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SafeAddAndMinus</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> num <span class="keyword">int</span> = <span class="number">0</span></span><br><span class="line">	<span class="keyword">var</span> mutex = <span class="built_in">new</span>(sync.Mutex)</span><br><span class="line">	<span class="keyword">var</span> wg = <span class="built_in">new</span>(sync.WaitGroup)</span><br><span class="line">	wg.Add(<span class="number">2</span>)</span><br><span class="line">	<span class="comment">// add</span></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(*sync.Mutex, *sync.WaitGroup)</span></span> &#123;</span><br><span class="line">		<span class="keyword">defer</span> wg.Done()</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">			mutex.Lock()</span><br><span class="line">			num++</span><br><span class="line">			mutex.Unlock()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;(mutex, wg) <span class="comment">// 加 1000 次</span></span><br><span class="line">	<span class="comment">// minus</span></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(*sync.Mutex, *sync.WaitGroup)</span></span> &#123;</span><br><span class="line">		<span class="keyword">defer</span> wg.Done()</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">			mutex.Lock()</span><br><span class="line">			num--</span><br><span class="line">			mutex.Unlock()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;(mutex, wg) <span class="comment">// 减 1000 次</span></span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="sync-Cond-消费者范式"><a href="#sync-Cond-消费者范式" class="headerlink" title="sync.Cond 消费者范式"></a>sync.Cond 消费者范式</h2><p>在生产者消费者模型中，通常会使用锁（如互斥锁）来保证数据的一致性：</p>
<ol>
<li>生产者/消费者先获取锁</li>
<li>如果获取失败，则进入睡眠</li>
<li>生产者/消费者处理完成后，会通知消费者/生产者继续执行</li>
</ol>
<p>即：加锁+循环&amp;等待+唤醒</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MIN_ICE_CNT = <span class="number">0</span></span><br><span class="line"><span class="keyword">const</span> MAX_ICE_CNT = <span class="number">3</span></span><br><span class="line"><span class="keyword">type</span> iceCube <span class="keyword">int</span></span><br><span class="line"><span class="keyword">type</span> cup <span class="keyword">struct</span> &#123;</span><br><span class="line">	iceCubes []iceCube</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">simulateProducerAndConsumer</span><span class="params">()</span></span> &#123;</span><br><span class="line">	stopCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">	lc := <span class="built_in">new</span>(sync.Mutex)</span><br><span class="line">	cond := sync.NewCond(lc)</span><br><span class="line">	cup := cup&#123;</span><br><span class="line">		iceCubes: <span class="built_in">make</span>([]iceCube, MIN_ICE_CNT, MAX_ICE_CNT),</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// consumer</span></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			cond.L.Lock()</span><br><span class="line">			<span class="keyword">for</span> <span class="built_in">len</span>(cup.iceCubes) == MIN_ICE_CNT &#123;</span><br><span class="line">				cond.Wait()</span><br><span class="line">			&#125;</span><br><span class="line">			cup.iceCubes = cup.iceCubes[<span class="number">1</span>:]</span><br><span class="line">			cond.Signal()</span><br><span class="line">			cond.L.Unlock()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="comment">// producer</span></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			cond.L.Lock()</span><br><span class="line">			<span class="keyword">for</span> <span class="built_in">len</span>(cup.iceCubes) == MAX_ICE_CNT &#123;</span><br><span class="line">				cond.Wait()</span><br><span class="line">			&#125;</span><br><span class="line">			cup.iceCubes = <span class="built_in">append</span>(cup.iceCubes, <span class="number">1</span>)</span><br><span class="line">			cond.Signal()</span><br><span class="line">			cond.L.Unlock()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> &lt;-stopCh: <span class="comment">// 等待通道关闭，或者一直执行下去</span></span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="json-结构定义"><a href="#json-结构定义" class="headerlink" title="json 结构定义"></a>json 结构定义</h2><p>json2struct idea 自带了，不赘述。</p>
<h2 id="项目生成类图"><a href="#项目生成类图" class="headerlink" title="项目生成类图"></a>项目生成类图</h2><p>goPlantUml 插件，用 plantUml 生成 uml，可以代码自动生成。</p>
<h2 id="标准目录"><a href="#标准目录" class="headerlink" title="标准目录"></a>标准目录</h2><ul>
<li><code>api</code>：对外暴露 api</li>
<li><code>cmd</code>：项目入口</li>
<li><code>conf</code>：项目配置文件</li>
<li><code>constant</code>：常量</li>
<li><code>docs</code>：设计文件</li>
<li><code>internal</code>：组件，与业务无关，比如 errors 等</li>
<li><code>pkg</code>：更纯净的组件，每个包都可以独立出来作为一个库</li>
<li><code>version</code>：当前版本</li>
<li><code>go.mod</code>：第三方依赖</li>
</ul>
<h2 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h2><p><code>go tool pprof</code> 是专门用来定位 go 项目性能瓶颈工具，不赘述。</p>
<h1 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h1><h2 id="好的开始是成功的一半"><a href="#好的开始是成功的一半" class="headerlink" title="好的开始是成功的一半"></a>好的开始是成功的一半</h2><p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/202312191627627.png" alt></p>
<ul>
<li>开发环境这里面我推荐大家要不就用 idea 原生的，要不就用 Goland 的，这两个其实是比较适合去开发 Go 的，不太推荐大家用什么 VScode，或者 VIM 去做这个事情。如果遇到像 Go mod 的时候，或者做一些三方应用的时候，其实 VScode 会有一些 bug，就是调试起来会比较麻烦。</li>
<li>代码格式化这里面强烈推荐大家用 gofmt 去统一做，它能帮你将这个代码统一的去做一个格式化。lint 这一块还是选择性开启吧。因为 lint 这个东西它在编译的时候，包括你在开发的时候，它会影响你的开发流畅度。</li>
<li>不要用 common 库的方式。所谓common库，就是一个全家桶，就是我所有所谓的这种工具类也好啊，util 包也好，我就弄成一个；包的职责 Go 这边推荐要单一。</li>
<li>包不要有状态，所谓的这个包的状态就是说有一些内部的状态机全局变量，这种都是要尽量避免的。</li>
<li>一般 Main 函数做什么呢？做这个 flag 参数解析，另外就是初始化一些配置，或者说把 log 提前都打好，然后再把数据库或者网络连接池，把它做好就可以了。</li>
<li>尽量 Go 不要去做这个 init 里面的开发，init 一般在什么时候用呢？它会在这个比如说你要注册一个 GUB 的时候，注册一个序列化的对象的时候，可以在 init 里面提前去注册。其他的场景其实暂时也不多。</li>
</ul>
<h2 id="基本规范"><a href="#基本规范" class="headerlink" title="基本规范"></a>基本规范</h2><p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/202312191737154.png" alt></p>
<ul>
<li>开发的规范就是驼峰式，基本上和 java 什么的都是类似的。</li>
<li>Go 有 4 个引用的，就是默认的传参，它已经是引用了，所以说我们不用传指针，就是 map、chan，还有这个函数 interface 这4个。</li>
<li>永远不要去启动一个停止不了的协程，不要让它永远阻塞在那。</li>
<li>你要开一个协程，要把这个开协程的授权调用授权给他的这个调用方。</li>
<li>上图左边的和右边的都有一些问题，比较好的写法是有一个退出信号，如果有调用方希望去 Go，那他就 Go 出来。</li>
</ul>
<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2><p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/202312191806425.png" alt></p>
<ul>
<li>好比 json 的这个序列化的时候，其实在基本上 99.99% 的情况他都不会出错。他一旦出错了，那一定是不可预期的。</li>
</ul>
<h2 id="让别人参与进来"><a href="#让别人参与进来" class="headerlink" title="让别人参与进来"></a>让别人参与进来</h2><p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/202312191814467.png" alt></p>
<ul>
<li>如果大家都不习惯用 Go 的这种默认测试框架，可以试试 testify。</li>
<li>日志和这个代码我认为都是给人看的，不是给机器看的，所以说日志一定要上下文能够清晰的表达出来你的这个逻辑或者你的这个含义。</li>
<li>不要注释那种不好的代码，直接重构它。</li>
<li>要敢于say no，就是有一些不合理的设计也好，或者不合理的需求也好，我们要有这种意识去说。</li>
<li>要掌握这种分布式的编程的思维，这种稳定性的这种的能力需要大家建立起来这种的意识。如果他出现了这种核心的 panic 也好，或者说宕机了，或者数据错了，我们要在心中就把握好那个度，要兜这个底。要知道他一个最坏的一个情况。</li>
</ul>
<h2 id="养好服务"><a href="#养好服务" class="headerlink" title="养好服务"></a>养好服务</h2><p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/202312191820312.png" alt></p>
<ul>
<li>pprof 这个 server，不要暴露在公网，如果暴露在公网了。</li>
<li>二进制的安全更多是放在一些 IDC 机房，因为这些资源它是不可控的。一旦你的磁盘坏了或者淘汰了你的这个二进制的应用很可能会被泄露。（可以使用一些混淆）</li>
<li>Go 会有一个开源的三方的一个 ANT 的库。这块其实它是一个协程池，节省资源。</li>
<li>漏斗原则，我在做一个什么 HTTPserver 也好啊，或者做一个什么消息队列服务也好啊，要有这种流控或者这种开关，要有这种 Quota，说白了不要去一股脑的把资源放给客户或者三方应用去使用。</li>
<li>这个操作系统层面需要知道这个 system 这个 rlimit 这个句柄。这个句柄现在是默认是 65535，或者没开的话，也就 1024。这块的话需要去注意一下，在跑这个应用性能的时候，这个句柄限制需要大家选择性的去开或者关。<ul>
<li>也可以用一些大招，比如说 cgroup 或者 Docker 这种去做一个物理上的一个资源层面上的隔离。</li>
</ul>
</li>
<li>告警一定要能处理，否则这个告警其实是没有任何意义的。</li>
</ul>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/202312191826489.png" alt></p>
<ul>
<li>新手容易犯的错误就是这个闭包引入外部变量。<ul>
<li>这个外部变量是个引用，你在循环调用它的时候，它每次这个值都是一个指针。所以说你在传值的时候一定要传他具体的这个对象，而不要传他的指针。</li>
</ul>
</li>
<li>defer 他跟这个函数的作用域无关，他只会在这个函数退出的时候执行。<ul>
<li>第一个的结果其实会先打出来 1 3 5 7 9，然后再把 10 8 6 4 2 打出来。</li>
<li>第二个其实是正常的，他的逻辑就是说我的这个 defer 只会在这个函数退出的时候执行。</li>
</ul>
</li>
</ul>
<h2 id="核心类型"><a href="#核心类型" class="headerlink" title="核心类型"></a>核心类型</h2><p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/202312191831111.png" alt></p>
<ul>
<li>map 是一个无序的集合。这块要注意一下，如果想用有序的，谷歌有一个开源的 BTree 的一个 map 是可以去用的，也是一个开源的三方包。</li>
<li>channel 是一个有锁的环形队列。无论它读、写也好啊，读码、写码也好啊，它都会 channel。无论你有没有缓冲区，就是你写满了读没了 channel 其实是都会阻塞的。</li>
<li><p>slice 不支持并发，动态的扩缩容，实际工程中大家会比较少用。</p>
</li>
<li><p>interface 这个数据类型它不是任意的类型，它不是 C++ 这个 void*，它其实还是一个对象，做类型转换的时候，比较这个 interface 它一定不是空。因为它在做这个类型转换的时候，它会隐式的将这个 interface 转换成这个对象的这个具体类型。它不仅仅包含了这个转换前变量的这个信息，还包含了这个类型的信息。</p>
</li>
</ul>
<h2 id="八股文"><a href="#八股文" class="headerlink" title="八股文"></a>八股文</h2><p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/202312191836814.png" alt></p>
<ul>
<li>你的本地是什么 1.17 的，然后线上的是 1.13，那就可以编译不过，而且你排查这个问题还会很麻烦，很费劲。</li>
<li>外如果是大家用 docker 比较多的话，要注意一下这个 runtime.GOMAXPROCS 这块他其实是获取的是这个宿主机的 CPU 的核，不是真正的 docker 的那个 CPU 的核。</li>
</ul>
<h2 id="书籍推荐"><a href="#书籍推荐" class="headerlink" title="书籍推荐"></a>书籍推荐</h2><p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/202312191840386.png" alt></p>
<ul>
<li>Go 圣经</li>
<li>Go 语言高级编程</li>
<li>Go 语言原本</li>
<li>DDIA</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="https://koonchenblog-1252050022.cos.ap-shanghai.myqcloud.com/img/blog/202312191839924.png" alt></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="https://github.com/koonchen">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#高频技艺"><span class="toc-number">1.</span> <span class="toc-text">高频技艺</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#函数集合"><span class="toc-number">1.1.</span> <span class="toc-text">函数集合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Context-教学"><span class="toc-number">1.2.</span> <span class="toc-text">Context 教学</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#普通异常处理"><span class="toc-number">1.3.</span> <span class="toc-text">普通异常处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义业务异常"><span class="toc-number">1.4.</span> <span class="toc-text">自定义业务异常</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Panic-处理"><span class="toc-number">1.5.</span> <span class="toc-text">Panic 处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sync-atomic-共享变量"><span class="toc-number">1.6.</span> <span class="toc-text">sync.atomic 共享变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sync-Mutex-上锁"><span class="toc-number">1.7.</span> <span class="toc-text">sync.Mutex 上锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sync-Cond-消费者范式"><span class="toc-number">1.8.</span> <span class="toc-text">sync.Cond 消费者范式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#json-结构定义"><span class="toc-number">1.9.</span> <span class="toc-text">json 结构定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#项目生成类图"><span class="toc-number">1.10.</span> <span class="toc-text">项目生成类图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#标准目录"><span class="toc-number">1.11.</span> <span class="toc-text">标准目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#性能优化"><span class="toc-number">1.12.</span> <span class="toc-text">性能优化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#最佳实践"><span class="toc-number">2.</span> <span class="toc-text">最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#好的开始是成功的一半"><span class="toc-number">2.1.</span> <span class="toc-text">好的开始是成功的一半</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基本规范"><span class="toc-number">2.2.</span> <span class="toc-text">基本规范</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#错误处理"><span class="toc-number">2.3.</span> <span class="toc-text">错误处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#让别人参与进来"><span class="toc-number">2.4.</span> <span class="toc-text">让别人参与进来</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#养好服务"><span class="toc-number">2.5.</span> <span class="toc-text">养好服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注意事项"><span class="toc-number">2.6.</span> <span class="toc-text">注意事项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#核心类型"><span class="toc-number">2.7.</span> <span class="toc-text">核心类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#八股文"><span class="toc-number">2.8.</span> <span class="toc-text">八股文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#书籍推荐"><span class="toc-number">2.9.</span> <span class="toc-text">书籍推荐</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">2.10.</span> <span class="toc-text">总结</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://chenzeping.com/after-reading/2023-12-19-golang-tips-in-ali/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://chenzeping.com/after-reading/2023-12-19-golang-tips-in-ali/&text=golang tips in ali"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://chenzeping.com/after-reading/2023-12-19-golang-tips-in-ali/&title=golang tips in ali"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://chenzeping.com/after-reading/2023-12-19-golang-tips-in-ali/&is_video=false&description=golang tips in ali"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=golang tips in ali&body=Check out this article: https://chenzeping.com/after-reading/2023-12-19-golang-tips-in-ali/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://chenzeping.com/after-reading/2023-12-19-golang-tips-in-ali/&title=golang tips in ali"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://chenzeping.com/after-reading/2023-12-19-golang-tips-in-ali/&title=golang tips in ali"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://chenzeping.com/after-reading/2023-12-19-golang-tips-in-ali/&title=golang tips in ali"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://chenzeping.com/after-reading/2023-12-19-golang-tips-in-ali/&title=golang tips in ali"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://chenzeping.com/after-reading/2023-12-19-golang-tips-in-ali/&name=golang tips in ali&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2024 Koon Chen
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="https://github.com/koonchen">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<!-- <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"> -->
<link rel="stylesheet" href="//cdn.staticfile.org/font-awesome/5.15.2/css/all.min.css">
<!-- <link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css"> -->
<link rel="stylesheet" href="//cdn.staticfile.org/justifiedGallery/3.6.5/css/justifiedGallery.min.css">

    <!-- jquery -->
<!-- <script src="/lib/jquery/jquery.min.js"></script> -->
<script src="//cdn.staticfile.org/jquery/3.3.1/jquery.min.js"></script>
<!-- <script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script> -->
<script src="//cdn.staticfile.org/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-109260587-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdn.bootcss.com/mathjax/2.7.6/MathJax.js?config=TeX-MML-AM_CHTML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>
